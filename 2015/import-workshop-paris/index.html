<!doctype html>

<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Import Workshop - Paris 2015</title>

    <meta name="description" content="Improving Import in OMERO 5">
    <meta name="author" content="the Open Microscopy Environment core team">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal-js/css/reveal.min.css">
    <link rel="stylesheet" href="reveal-js/css/theme/default.css" id="theme">

    <!-- OME presentation overrides of the default theme -->
    <style>
      .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6 {
        text-transform: none;
      }
      .reveal h2 {
          font-size: 60px;
      }
      .reveal h3 {
          font-size: 50px;
      }
      .ome_theme {
          background-image: url("diagrams/ome-icon-opacity.png");
          background-color: #f2f6f9;
          background-repeat: no-repeat;
          background-position: right -270px top -120px;
      }
      .reveal {
          text-transform: none;   !important
      }

      .img_panel {
          width: 150px;
      }

      .nobullet li {
          list-style: none;
      }

      table.centre {
          width: 100%;
      }

      .reveal .centre td {
          text-align: center;
      }

      .rot90 {
          -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
      }

      .reveal .title {
          position:absolute;
          bottom:100%;
          margin:5px;
          color:red;
      }

      .larger {
          font-size: 80px !important;
      }

      .reveal h1 {
        font-size: 96px;
      }

      .reveal p,
      .reveal pre {
        margin-top: 2em;
        margin-bottom: 2em;
        line-height: 1.5;
      }

      .reveal pre {
        background: #FFFFFF;
        width: 100%;
        margin-left: 0;
      }

      .reveal code {
        font-size: 28px;
      }

      .reveal li {
        margin-top: 0.25em;
        margin-bottom: 0.25em;
      }

      .reveal section img {
        background: rgba(0, 0, 0, 0);
        box-shadow: none;
        border: none;
      }

      .reveal q {
        quotes: inherit;
        font-style: normal;
      }
    </style>

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="reveal-js/lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="reveal-js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body class="ome_theme">

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <!-- Title and overall introduction -->
        <section>
          <h1>Improving Imports with OMERO 5.x</h1>
          <h2>Paris 2015</h2>
          <p>Colin Blackburn, Mark Carroll &amp; Josh Moore</p>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h2>Outline</h2>
          <ul>
            <li>Import in OMERO 5</li>
            <li>More ways to import</li>
            <li>Improving import efficiency</li>
            <li>A few more improvements</li>
            <li>Discussion</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <!-- Introduction -->
        <section>
          <h2>Import in OMERO 5</h2>
          <h3>A quick reminder...</h3>
          <ul>
            <li>ManagedRepository</li>
            <li>Filesets</li>
            <li>Basic OMERO 5 Import</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h3>ManagedRepository</h3>
          <img src="diagrams/managedrepo-intro.png" width="100%"/>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h3>Filesets</h3>
          <img src="diagrams/filesets.png" width="100%"/>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <section>
            <h3>OMERO 5 Import</h3>
            <img src="diagrams/upload.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h3>OMERO 5 Data out</h3>
            <img src="diagrams/download.png" width="90%"/>
            <aside class="notes">
          </section>
        </section>

        <section>
          <h3>More on ManagedRepository and Filesets</h3>
          <ul>
            <li>link to docs</li>
            <li>2014 talk</li>
            <li>2013 talk?</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h2>More ways to import</h2>
          <ul>
            <li>Upload and copy</li>
            <li>In-place</li>
            <li>Import for</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <section data-transition="none">
            <h3>Import: upload</h3>
            <code>
              $ bin/omero import path/to/image -- --transfer=upload
            </code>
            <img src="diagrams/upload.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section data-transition="none">
            <h3>Import: upload and remove</h3>
            <code>
              $ bin/omero import path/to/image -- --transfer=upload_rm
            </code>
            <img src="diagrams/upload.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section data-transition="none">
            <h3>Import: upload and remove</h3>
            <code>
              $ bin/omero import path/to/image -- --transfer=upload_rm
            </code>
            <img src="diagrams/upload_rm.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>
        </section>

        <section>
          <section data-transition="none">
            <h3>Import: copy</h3>
            <code>
              $ bin/omero import path/to/image -- --transfer=cp
            </code>
            <img src="diagrams/import-cp.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section data-transition="none">
            <h3>Import: copy and delete</h3>
            <code>
              $ bin/omero import path/to/image -- --transfer=cp_rm
            </code>
            <img src="diagrams/import-cp.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section data-transition="none">
            <h3>Import: copy and delete</h3>
            <code>
              $ bin/omero import path/to/image -- --transfer=cp_rm
            </code>
            <img src="diagrams/import-cp_rm.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>
        </section>

        <section>
          <section data-transition="none">
            <h3>In-place import: hard link</h3>
            <code>
              $ bin/omero import path/to/image -- --transfer=ln
            </code>
            <img src="diagrams/inplace-ln.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section data-transition="none">
            <h3>In-place import: move</h3>
            <code>
              $ bin/omero import path/to/image -- --transfer=ln_rm
            </code>
            <img src="diagrams/inplace-ln.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section data-transition="none">
            <h3>In-place import: move</h3>
            <code>
              $ bin/omero import path/to/image -- --transfer=ln_rm
            </code>
            <img src="diagrams/inplace-ln_rm.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>
        </section>

        <section>
          <h3>In-place import: soft link</h3>
          <code>
            $ bin/omero import path/to/image -- --transfer=ln_s
          </code>
          <img src="diagrams/inplace-ln_s.png" width="90%"/>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h3>Import: CLI summary</h3>
          <pre style="font-size:60%">

  bin/omero import --advanced-help

    --transfer=ARG            File transfer method

        General options:
          upload            # Default
          upload_rm         # Caution! Upload followed by source deletion.
          some.class.Name   # Use a class on the CLASSPATH.

        Server-side options:
          ln                # Use hard-link.
          ln_s              # Use soft-link.
          ln_rm             # Caution! Hard-link followed by source deletion.
          cp                # Use local copy command.
          cp_rm             # Caution! Copy followed by source deletion.

  e.g. $ bin/omero import -- --transfer=ln_s foo.tiff
       $ ./importer-cli --transfer=ln bar.tiff
          </pre>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h2>Use cases</h2>
          <ul>
            <li>Upload - data on separate system</li>
            <li>Copy - data on same system, avoids network overheads</li>
            <li>Hard link - very large data on OMERO server</li>
            <li>Soft link - DropBox on OMERO server</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <section data-transition="none">
            <h3>Import for: using Insight</h3>
            <img src="diagrams/importas.png" width="100%"/>
            <aside class="notes">
            </aside>
          </section>
          <section data-transition="none">
            <h3>Import for: using Insight</h3>
            <img src="diagrams/importas-yes.png" width="100%"/>
            <aside class="notes">
            </aside>
          </section>
          <section data-transition="none">
            <h3>Import for: using Insight</h3>
            <img src="diagrams/importas-no.png" width="100%"/>
            <aside class="notes">
            </aside>
          </section>
          <section data-transition="none">
            <h3>Import for: using the CLI</h3>
            <pre style="font-size:60%">

  bin/omero login -u user-3 --sudo user-6
  Password for user-6:
  Created session f49d2...65250 (user-3@...). Current group: read-annotate-1
  bin/omero import ~/Work/Images/dv/IAGFP-Noc01_R3D.dv
  Using session f49d2...65250 (user-3@...). Current group: read-annotate-1
  ...
  ==> Summary
  2 files uploaded, 1 fileset created, 1 image imported,
  0 errors in 0:00:21.602
            </pre>
            <aside class="notes">
            </aside>
          </section>
        </section>

        <section>
          <h2>More efficient imports</h2>
          <ul>
            <li>Background imports</li>
            <li>Faster imports</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h3>Background imports</h3>
          <pre style="font-size:60%">

  --auto_close        Close completed imports immediately.

  --minutes_wait=ARG  Choose how long the importer will wait on
                      server-side processing.
                      ARG > 0 implies the number of minutes to wait.
                      ARG = 0 exits immediately.
                              Use a *_completed option to clean up.
                      ARG < 0 waits indefinitely. This is the default.

  --close_completed         Close completed imports.

  --wait_completed          Wait for all background imports to complete.

  e.g. $ bin/omero import -- --auto_close file1.tiff
       $ bin/omero import -- --minutes_wait=0 img1.tiff img2.tiff img3.tiff
       $ bin/omero import -- --wait_completed # Waits on all 3 imports.
          </pre>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <section>
            <h2>Faster imports</h2>
            <pre style="font-size:60%">

  --checksum-algorithm=ARG  Choose a possibly faster algorithm
                            for detecting file corruption,
                            e.g. File-Size-64 (fastest),
                                 Adler-32 (faster), CRC-32 (faster),
                                 MD5-128, Murmur3-32, Murmur3-128,
                                 SHA1-160 (slower, default)

  e.g. $ bin/omero import -- --checksum-algorithm=CRC-32 foo.tiff
       $ ./importer-cli --checksum-algorithm=Murmur3-128 bar.tiff

  --no-stats-info   Disable calculation of minima and maxima when
                    not part of the Bio-Formats reader metadata

  --no-thumbnails   Do not perform thumbnailing after import

  --no-upgrade-check    Disable upgrade check for each import
            </pre>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>Faster imports</h2>
            <pre style="font-size:60%">

  bin/omero import --help

  --skip {all,checksum,minmax,thumbnails,upgrade}
         Optional step(s) to skip during import
            </pre>
            <aside class="notes">
            </aside>
          </section>
        </section>

        <section>
          <h3>A few numbers</h2>
          <center>
            <table style="font-size: 100%; border=2px; background: #FFFFFF" cellspacing="15" cellpadding="15">
              <tr>
                <th></th>
                <th></th>
                <th>default</th>
                <th colspan=3 class="centre">symlink &amp; skip all</th>
              </tr>
              <tr>
                <th>format</th>
                <th>size</th>
                <th>total</th>
                <th>symlink</th>
                <th>import</th>
                <th>total</th>
              </tr>
              <tr>
                <td>Zeiss CZI</td>
                <td>200GB</td>
                <td>4.5h</td>
                <td>6s</td>
                <td>3m</td>
                <td>3m</td>
              </tr>
              <tr>
                <td>SPIM</td>
                <td>~2TB</td>
                <td>days?</td>
                <td>14m</td>
                <td>16m</td>
                <td>30m</td>
              </tr>
              <tr>
                <td>SVS</td>
                <td>90GB</td>
                <td>---</td>
                <td>7m</td>
                <td>23m</td>
                <td>30m</td>
              </tr>
            </table>
          </center>
        </section>

        <section>
          <section>
            <h2>A few more improvements</h2>
            <h3>Excluding duplicates</h3>
              <pre style="font-size:60%">

    --exclude=filename        Exclude files based on filename.

    e.g. $ bin/omero import -- --exclude=filename foo.tiff
           # First call imports
         $ bin/omero import -- --exclude=filename foo.tiff
           # Second call skips
         $ bin/omero import foo.tiff
           # This call imports again
              </pre>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h2>A few more improvements</h2>
            <h3>Move a fileset</h3>
            <pre style="font-size:60%">

  bin/omero fs rename --help
  usage: omero fs rename [--no-move] fileset

  Moves an existing fileset to a new location (admin-only)

  After the import template (omero.fs.repo.path) has been changed,
  it may be useful to rename an existing fileset to match the new
  template. By default the original files and import log are also
  moved.

  Positional Arguments:
    fileset             Fileset which should be renamed: ID or Fileset:ID

  Optional Arguments:
    --no-move           do not move original files and import log
            </pre>
            <aside class="notes">
            </aside>
          </section>
          <section>
            <h2>A few  more improvements</h2>
            <h3>Remove empty directories</h3>
            <pre style="font-size:60%">

  bin/omero admin cleanse --help
  usage: omero admin cleanse [--dry-run] data_dir

  Remove binary data files from OMERO

  Deleting an object from OMERO currently may not remove all the binary data.
  Use this command either manually or in a cron job periodically to remove
  Pixels, empty directories, and other data.


  Examples:
    bin/omero admin cleanse --dry-run /OMERO  # Lists files to be deleted.
    bin/omero admin cleanse /OMERO            # Actually delete them.
            </pre>
            <aside class="notes">
            </aside>
          </section>
        </section>

        <section>
          <h2>The future...</h2>
          <ul>
            <li>import location</li>
            <li>importer role</li>
            <ul><li>advanced-importer role</li></ul>
            <li>extra performance</li>
            <li>cron - later thumbnailing</li>
            <li>these features in Insight</li>
            <li>Web import</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h2>Thanks!</h2>
          <ul>
            <li>the "import team"</li>
            <li>the OME team</li>
            <li>the user community</li>
            <li>our funders??</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h2>Discussion</h2>
          <h3>What else do you want</h3>
          <h1 style="font-size:500%">?</h1>
          <aside class="notes">
          </aside>
        </section>

      </div> <!-- end class="slides" -->

    </div> <!-- end class="reveal" -->

    <script src="reveal-js/lib/js/head.min.js"></script>
    <script src="reveal-js/js/reveal.min.js"></script>
    <script>
        // Full list of configuration options available here:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,

            theme: 'sky', //Reveal.getQueryHash().theme, // available themes are in /css/theme
            transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

            // Optional libraries used to extend on reveal.js
            dependencies: [
                // { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                // { src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                // { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                // { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                // { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                // { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                // { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
                // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
            ]
        });
    </script>

  </body>
</html>
