<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>OMERO.fs Workshop - Paris 2013</title>

    <meta name="description" content="Introducing FS in OMERO 5">
    <meta name="author" content="the Open Microscopy Environment core team">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">

    <!-- OME presentation overrides part of the default theme -->
    <link rel="stylesheet" href="css/theme/override.css">

    <!-- from Will Moore -->
    <style>
      .ome_theme {
        background-image: url("images/ome-icon-opacity.png");
        background-color: #f2f6f9;
        background-repeat: no-repeat;
        background-position: right -270px top -120px;
      }
    </style>

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body class="ome_theme">

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section>

          <h1>FS Workshop</h1>
          <h2>Paris 2013</h2>

          <p>How OMERO 5 uses FS to preserve your original image files on OMERO.server.</p>

        </section>

        <section>

          <section>

            <h1>Importing Before FS</h1>

            <ul>
              <li>client software extracts planes from image files</li>
              <li>server stores and uses large Pixels files</li>
              <li>additionally, original files could be archived</li>
            </ul>

          </section>

          <section>

            <h1>Client to Server</h1>
            <h2>OMERO 4</h2>

            <img src="diagrams/from-client-v4.png" width="75%"/>

          </section>

          <section>

            <h1>Server to Client</h1>
            <h2>OMERO 4</h2>

            <img src="diagrams/to-client-v4.png" width="75%"/>

          </section>

          <section>

            <h1>Rendering Pipeline</h1>
            <h2>OMERO 4</h2>

            <ul>
              <li>clients obtain rendered images from server</li>
              <li>Pixels structure is optimized for reading</li>
              <li>rendering is thus a fast, direct process</li>
            </ul>

          </section>

        </section>

        <section>

          <section>

            <h1>What is FS?</h1>

            <ul>
              <li>stores only the original files</li>
              <li>clients need only wait for file upload</li>
              <li>no file data corruption on transfer into FS</li>
              <ul>
                <li>client and server compare files to verify clean copy</li>
              </ul>
              <li>Project/Dataset, Screen/Plate hierarchy remains</li>
            </ul>

          </section>

          <section>

            <h1>Client to Server</h1>
            <h2>OMERO 5</h2>

            <img src="diagrams/from-client-v5.png" width="75%"/>

          </section>

          <section>

            <h1>Server to Client</h1>
            <h2>OMERO 5</h2>

            <img src="diagrams/to-client-v5.png" width="75%"/>

          </section>

          <section>

            <h1>Rendering Pipeline</h1>
            <h2>OMERO 5</h2>

            <ul>
              <li>managed repository holds uploaded image files</li>
              <li>Bio-Formats extracts planes from image files</li>
              <li>server now needs Bio-Formats for rendering</li>
              <li>Bio-Formats performance much improved</li>
              <li><em>performance numbers coming real soon</em></li>
            </ul>

          </section>

        </section>

        <section>

          <section>

          <!-- Presenter's notes:
          =======================
          Something along the lines of "to implement this" or "while implementing this
          we realized that we were going to need to introduce a new construct..."
          -->

            <h1>What is a Fileset?</h1>

            <ul>
              <li>a set of related files</li>
              <ul>
                <li>Bio-Formats must read them together</li>
              </ul>
              <li>a set of images, arising from those files</li>
              <li>may be just one file and one image</li>
            </ul>

          </section>

          <section>

            <h1>A Simple Fileset</h1>

            <img src="diagrams/fileset-simple.png" width="75%"/>

          </section>

          <section>

            <h1>A More Realistic Fileset</h1>

            <img src="diagrams/fileset.png" width="75%"/>

          </section>

          <section>

            <h1>Fileset Indivisibility</h1>

            <ul>
              <li>Bio-Formats is used in rendering</li>
              <ul>
                <li>readers are cached, for speed</li>
              </ul>
              <li>files must be kept together for Bio-Formats</li>
              <li>must also associate the files' images</li>
              <ul>
                <li>they need not be in the same dataset</li>
              </ul>
            </ul>

          </section>

          <section>

            <h1>Effects of Indivisibility</h1>

            <ul>
              <li>cannot break fileset by changing or deleting a part</li>
              <li>repository changes should be via server API</li>
              <li>server prohibits certain acts on partial filesets</li>
              <ul>
                <li>only operations affecting file accessibility</li>
                <li>namely: change group, delete</li>
              </ul>
            </ul>

          </section>


        </section>

        <section>

          <section>

            <h1>Why Use FS?</h1>

            <ul>
              <li>does not create large Pixels files</li>
              <ul>
                <li>no duplication of image data</li>
              </ul>
              <li>preserve original data structure</li>
              <ul>
                <li>file names and contents</li>
                <li>directories, if needed for Bio-Formats</li>
                <li>stored data accessible by other software</li>
                <li>or in the case of catastropic DB loss</li>
              </ul>
            </ul>

          </section>

          <section>

            <h1>More FS Advantages</h1>

            <ul>
              <li>OMERO.server becomes master data repository</li>
              <li>each fileset has an import log</li>
              <li>Bio-Formats improvements benefit older data</li>
              <li>share experimental data, reproduce analyses</li>
            </ul>

          </section>

        </section>

        <section>

          <section>

            <h1>FS in Action</h1>

            <p>We now demonstrate FS as it is today.</p>

          </section>

          <section>

            <h1>Demo Script</h1>

            <ul style="font-size: small; line-height: 1.2">
              <li>file import is fast</li>
              <li>import log</li>
              <li>checksums dialog</li>
              <li>file paths popup</li>
              <li>download files, content intact</li>
              <li>change group: partial fails</li>
              <li>change group: complete succeeds</li>
              <li>delete: partial fails</li>
              <li>delete: complete succeeds</li>
              <li>split fileset images across datasets</li>
            </ul>

          </section>

        </section>

        <section>

          <h1>Migrating to FS</h1>

          <ul>
            <li>new OMERO users should try out OMERO 5</li>
            <ul>
              <li>upgrades from beta to beta will be provided</li>
            </ul>
            <li>upgrades from OMERO 4 currently being tested</li>
            <ul>
              <li>process for upgrade to be released after summer</li>
            </ul>
            <li>no near-term plans to allow merging servers!</li>
          </ul>

        </section>

        <section>

          <section>

            <h1>Planned Work</h1>

            <ul>
              <li>ensure that every file has a checksum noted</li>
              <li>periodically re-verify checksums</li>
              <ul>
                <li>user notification of mismatches</li>
              </ul>
              <li>reconsider image deletion</li>
              <ul>
                <li>server-side re-import recovers image?</li>
              </ul>
            </ul>

          </section>

          <section>

            <h1>Next-Generation FS</h1>

            <ul>
              <li>import without Bio-Formats on clients</li>
              <ul>
                <li>all file format scanning done on server</li>
              </ul>
              <li>server renders images from user-managed directories</li>
              <ul>
                <li>could be from remote network mount</li>
                <li>user need not use importer to upload files</li>
              </ul>
            </ul>

          </section>

        </section>

        <section>

          <h1>Any Feedback?</h1>

          <ul>
            <li>We welcome questions and comments on FS.</li>
            <li>What further work on FS would be  most useful?</li>
            <li>Would you like to try out FS at your site?</li>
          </ul>

        </section>

        <section>

          <section>

            <h1>Configuring FS</h1>
            <h2>etc/omero.properties</h2>
            <h3>Managed Repository Directory</h3>

            <pre>omero.data.dir=/OMERO/
              omero.managed.dir=${omero.data.dir}/ManagedRepository</pre>

          </section>

          <section>

            <h1>Configuring FS</h1>
            <h2>etc/omero.properties</h2>
            <h3>Template Paths</h3>

            <pre>omero.fs.repo.path=%user%_%userId%/%year%-%month%/%day%/%time%</pre>

          </section>

          <section>

            <h1>Configuring FS</h1>
            <h2>etc/omero.properties</h2>
            <h3>Permitted File Naming</h3>

            <pre>omero.fs.repo.path_rules=Windows required, UNIX required</pre>

          </section>

          <section>

            <h1>Configuring FS</h1>
            <h2>etc/omero.properties</h2>
            <h3>Default Checksum Algorithm</h3>

            <pre>omero.checksum.default=SHA1-160</pre>

          </section>

        </section>

        <section>

          <section>

            <h1>FS in SQL</h1>
            <h2>Find an Image's Fileset</h2>

            <pre>SELECT fileset FROM image WHERE id = ?</pre>

          </section>

          <section>

            <h1>FS in SQL</h1>
            <h2>Find Images in Fileset</h2>

            <pre>SELECT name FROM image WHERE fileset = ?</pre>

          </section>

          <section>

            <h1>FS in SQL</h1>
            <h2>Find Paths of Files in Fileset</h2>

            <pre>SELECT of.path || of.name 
FROM originalfile of, filesetentry fse 
WHERE of.id = fse.originalfile 
AND fse.fileset = ?</pre>

          </section>

          <section>

            <h1>FS in SQL</h1>
            <h2>Find Checksums of Files in Fileset</h2>

            <pre>SELECT of.name, ca.value, of.hash 
FROM originalfile of, filesetentry fse, checksumalgorithm ca 
WHERE of.hasher = ca.id 
AND of.id = fse.originalfile 
AND fse.fileset = ?</pre>

          </section>

        </section>

      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: 'sky', // Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
