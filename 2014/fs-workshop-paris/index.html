<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Import Workshop - Paris 2014</title>

    <meta name="description" content="Import in OMERO 5">
    <meta name="author" content="the Open Microscopy Environment core team">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">

    <!-- OME presentation overrides part of the default theme -->
    <link rel="stylesheet" href="css/theme/override.css">

    <!-- from Will Moore -->
    <style>
      .ome_theme {
        background-image: url("images/ome-icon-opacity.png");
        background-color: #f2f6f9;
        background-repeat: no-repeat;
        background-position: right -270px top -120px;
      }
    </style>

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write(
        '<link rel="stylesheet" href="css/print/'
        + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' )
        + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body class="ome_theme">

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <!-- Talk introduction - All ?? -->
        <section>
          <h2>Managing Import in OMERO5</h2>
          <h3>Paris 2014</h3>
          <p>Mark Carroll, Colin Blackburn &amp; Josh Moore</p>
          <aside class="notes">
          </aside>
        </section>

        <section>
            <h2>Outline</h2>
            <ul>
                <li>Introduction to OMERO 5</li>
                <li>Advanced import</li>
                <li>Advanced data output</li>
                <li>Advanced administration</li>
                <li>Discussion</li>
            </ul>
            <aside class="notes">
            </aside>
        </section>

        <!-- Introduction - Colin/Mark ?? -->
        <section>
            <h2>Introduction to OMERO 5</h2>
            <ul>
                <li>Changes in OMERO 5</li>
                <li>ManagedRepository</li>
                <li>Filesets</li>
                <li>Upgrades</li>
            </ul>
            <aside class="notes">
            </aside>
        </section>

        <section>
          <section>
            <h2>Changes in OMERO 5</h2>
            <p>
              OMERO 5 introduces improvements to image import that preserve
              your original data and reduce data duplication.
            </p>
            <p>
              We begin by outlining the change that came with
              version&nbsp;5.0.0: OMERO.fs.
            </p>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h3>OMERO 5 Import</h3>
            <img src="diagrams/upload.png" width="100%"/>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h3>OMERO 5 Data out</h3>
            <img src="diagrams/data-out.png" width="100%"/>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h2>OMERO 4 Import</h2>
            <ul>
              <li>client sends image planes over the network</li> <!-- for contrast with in-place -->
              <ul>
                <li>stored as <q>Pixels</q>, an internal uncompressed format</li>
              </ul>
              <li><em>additionally</em>, original <q>archived</q> files can be stored</li>
              <ul>
                <li>though not for HCS plates</li>
              </ul>
              <li>pyramids stored for all large images</li>
            </ul>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h2>OMERO 5 Import</h2>
            <ul>
              <li>client uploads <em>only</em> original data</li>
              <ul>
                <li>including HCS plates, everything is <q>archived</q></li>
              </ul>
              <li>server <em>does not</em> store Pixels files</li>
              <li>pyramids stored for few large images</li>
              <ul>
                <li><em>only</em> those without subresolutions in file</li>
              </ul>
            </ul>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h2>OMERO 5 Data out</h2>
            <ul>
              <li>pixels provided directly from original files</li>
              <ul>
                <li>server-side Bio-Formats</li>
              </ul>
              <li>original files always available for download</li>
              <ul>
                <li>including HCS plates</li>
              </ul>
            </ul>
            <aside class="notes">
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h3>ManagedRepository</h3>
            <img src="diagrams/managedrepo-intro.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h2>ManagedRepository</h2>
            <ul>
              <li>server stores and reads original data</li>
              <li>OMERO acts as repository of original data</li>
              <li>without Pixels files, less data duplication</li>
              <li>original data visible in server filesystem</li>
              <ul>
                <li>where filesets live</li>
                <li>each Fileset in its own subdirectory</li>
              </ul>
            </ul>
            <aside class="notes">
              More advanced use later.
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h3>Filesets: One to one</h3>
            <img src="diagrams/fileset_1x1.png" width="100%"/>
            <aside class="notes">
              This diagram is to be tidied if okay in principle.
            </aside>
          </section>

          <section>
            <h3>Filesets: One to many</h3>
            <img src="diagrams/fileset_1xn.png" width="100%"/>
            <aside class="notes">
              This diagram is to be tidied if okay in principle.
            </aside>
          </section>

          <section>
            <h3>Filesets: Many to many</h3>
            <img src="diagrams/fileset_nxn.png" width="100%"/>
            <aside class="notes">
              This diagram is to be tidied if okay in principle.
            </aside>
          </section>

          <section>
            <h3>Filesets: Summary</h3>
            <ul>
              <li>a set of related files</li>
              <ul>
                <li>Bio-Formats must read them together</li>
              </ul>
              <li>a set of images, arising from those files</li>
              <li>may be just one file and one image</li>
              <li>Project/Dataset, Screen/Plate hierarchy remains</li>
            </ul>
            <aside class="notes">
              The diagrams below are option but might be useful.
            </aside>
          </section>
        </section>

        <section>
          <h2>Migrating to FS</h2>
          <ul>
            <li>new OMERO users should use OMERO 5</li>
            <li>upgrade scripts provided from OMERO 4</li>
            <li><q>pre-FS</q> images still Pixels, not in Fileset</li>
            <li><q>synthetic</q> images also not in Fileset</li>
            <ul>
              <li>for instance: projections, kymographs</li>
            </ul>
          </ul>
            <aside class="notes">
              We need to make it clear here that this is just the upgrade
              rather than the data transformation Josh covers later.
            </aside>
        </section>

        <!-- Advanced import - Colin ?? -->
        <section>
            <h2>Advanced import</h2>
            <ul>
                <li>In-place import</li>
                <li>DropBox import</li>
                <li>Polling &amp; cron job import</li>
            </ul>
            <aside class="notes">
            </aside>
        </section>

        <section>
          <section>
            <h2>In-place import</h2>
            <ul>
              <li>client transfers original data to ManagedRepository</li>
              <ul>
                <li>uploads - deafult as already outlined</li>
                <li>creates soft links</li>
                <li>creates hard links</li>
                <li>creates hard links followed by delete of source files</li>
                <li>employs user-defined transfer mode</li>
              </ul>
              <li>server-side import as previously outlined</li>
              <li>Potential for even less data duplication</li>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h3>In-place import: ln_s</h3>
            <img src="diagrams/inplace-ln_s.png" width="100%"/>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h3>In-place import: ln</h3>
            <img src="diagrams/inplace-ln.png" width="100%"/>
            <aside class="notes">
              This diagram needs duplicating to show the different methods.
            </aside>
          </section>

          <section data-transition="none">
            <h3>In-place import: ln_rm</h3>
            <img src="diagrams/inplace-ln.png" width="100%"/>
            <aside class="notes">
              This diagram needs duplicating to show the different methods.
            </aside>
          </section>

          <section data-transition="none">
            <h3>In-place import: ln_rm</h3>
            <img src="diagrams/inplace-ln_rm.png" width="100%"/>
            <aside class="notes">
              This diagram needs duplicating to show the different methods.
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h3>DropBox</h3>
            <img src="diagrams/dropbox_now.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h3>DropBox</h3>
            <img src="diagrams/dropbox_future.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h2>DropBox import</h2>
            <ul>
              <li>DropBox can be configured to use in-place import</li>
              <li>This can remove server-side duplication</li>
              <li>Future work</li>
              <ul>
                <li>More configuration</li>
                <li>Container details captured in paths</li>
              </ul>
            </ul>
            <aside class="notes">
            </aside>
          </section>
        </section>

        <section>
          <h2>Polling &amp; cron job import</h2>
            <ul>
              <li>Extending DropBox to run in polling mode</li>
              <li>This can also be configure for a cron job</li>
            </ul>
          <aside class="notes">
          </aside>
        </section>

        <!-- ===============================================
        Advanced output & admin - Josh/Colin
        ================================================ -->

        <section>
          <section>
            <h2>Advanced repository layouts</h2>
            <ul>
                <li>Templates</li>
                <li>Samba &amp; ldap mapping</li>
                <li>Quotas</li>
                <li>Adding disks</li>
            </ul>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h2>Finding your ManagedRepository</h2>
            <table>
                <tr>
                    <td>
                        <code>
$ bin/omero fs repos
                        </code>
                    </td>
                </tr>
                <tr>
                    <td>
                        <pre>
 # | Id   | UUID                                 | Type    | Path                             
---+------+--------------------------------------+---------+----------------------------------
 0 | 1    | c8db8f5c-b6ba-472f-b0d5-3dac4f31be66 | Public  | /home/data/ome2                  
 1 | 2    | ScriptRepo                           | Script  | /opt/ome2/dist/lib/scripts       
 2 | 3    | c4df3508-cffe-4bf2-a1c8-b3c1395f737f | Managed | /home/data/ome2/ManagedRepository
(3 rows)
                        </pre>
                    </td>
                </tr>
            </table>
            <aside class="notes">
              Files go into locations based on the template.
              (Explanation slide on template if this hasn't
              happened sooner)

              For example, depending on the template, each
              user can be access to his/her directory via
              SAMBA. (Requires mapping at the OS level,
              yadda yadda yadda).

              Similarly, the templates can be used to help
              migrating from one disk to another.

              In general, though, the layout requires some
              planning, and possibly some initial clean up
              of the DB.

              demoing any of `bin/omero fs` useful ??
            </aside>
          </section>

        </section>

        <section>
          <section>
            <h2>Template configuration</h2>
            <table>
                <tr>
                    <td>
                        <pre>
# Template for FS managed repository paths.
# Allowable elements are:
# %user%       bob
# %userId%     4
# %group%      bobLab
# %groupId%    3
# %year%       2011
# %month%      01
# %monthname%  january
# %day%        01
# %time%       15-13-54.014
# /            path separator
#
# %user%_%userId%/ must come first, and the path must be unique per fileset
# to prevent upload conflicts, which is why %time% includes milliseconds.
#
# The template path is created below &lt;omero.managed.dir&gt;,
# e.g. /OMERO/ManagedRepository/&lt;omero.fs.repo.path&gt;/
omero.fs.repo.path=%user%_%userId%/%year%-%month%/%day%/%time%
                        </pre>
                    </td>
                </tr>
            </table>
            <aside class="notes">
            General thinking: show them what's configurable
            </aside>
          </section>

          <section data-transition="none">
            <h3>Templates</h3>
            <img alt="Template diagram" src="diagrams/managedrepo-template.png" width="90%"/>
            <aside class="notes">
            "In a somewhat more attractive form..."
            </aside>
          </section>

          <section data-transition="none">
            <h3>Templates</h3>
            <img src="diagrams/managedrepo-shared.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

          <section data-transition="none">
            <h3>Templates</h3>
            <img src="diagrams/managedrepo-user.png" width="90%"/>
            <aside class="notes">
            </aside>
          </section>

        </section>

        <section>

          <section>
            <h2>Samba &amp; ldap mapping</h2>
            <ul>
                <li>/OMERO/ManagedRepository can be mapped via Samba</li>
                <li>Safest for read-only access</li>
                <li>Best if per-user mapping can be applied</li>
            </ul>
            <aside class="notes">
              For example, depending on the template, each
              user can be access to his/her directory via
              SAMBA. (Requires mapping at the OS level,
              yadda yadda yadda).
            </aside>
          </section>

          <section>
            <h3>Samba</h3>
            <img src="diagrams/samba.png" width="100%"/>
            <aside class="notes">
              Is there a reasonable diagram?
              One in graffle looked partially complete.
            </aside>
          </section>
        </section>

        <section>

          <section>
            <h2>Quotas</h2>
            <img alt="Template starting with groupId"
                src="diagrams/template-group.png" width="100%"/>
          </section>

          <section>
            <h2>Quotas</h2>
            <p>By adding "%groupId%" at the top of the template,
            getting diskspace usage per group should be easier.</p>
            <aside class="notes">
            </aside>
          </section>

        </section>

        <section>

          <section>
            <h2>Adding disks</h2>
            <img alt="Template starting with drive"
                src="diagrams/template-drive.png" width="100%"/>
          </section>

          <section>
            <h2>Adding disks</h2>
            <p>Adding other disks, should be as simple as adding a
            mount-point under /OMERO/ManagedRepository</p>
            <aside class="notes">
              Josh: Although I'd really like to allow spinning up multiple
              managed repos and choosing them based on number of stars or
              whatever, for the moment, I _bet_ it's going to be simpler to have
              a single managed repo and just change the template path when the
              time comes to move to another disk. Only caveat is that all the
              new mounts will have to be under /OMERO/ManagedRepo.
            </aside>
          </section>
        </section>

        <section>

          <section>
            <h2>Other advanced tasks</h2>
            <ul>
                <li>pre-FS -> FS migration</li>
                <li>Java-less import</li>
            </ul>
            <aside class="notes">
            </aside>
          </section>

          <section>
            <h2>pre-FS -&gt; FS migration</h2>
            <ul>
                <li>OMERO4 and before allowed <b>archiving</b> original files</li>
                <li><code>bin/omero fs images --archived</code></li>
                <li>Preparing user script to help conversion</li>
                <li>Limitations</li>
            </ul>
            <aside class="notes">
                Josh: I've nearly got something working on my branch of the same
                ticket number. Debating whether or not to go ahead and move it
                server-side before Paris since the one thing I can't do in my
                pytest is delete the Pixels on disk. (No API method for that)
                In general it works though.
                Add bp from PR2503 '12176 attach fsfiles'
            </aside>
          </section>

          <section>
            <h3>Java-less import</h3>
            <img src="diagrams/import-no-bf.png" width="100%"/>
            <aside class="notes">
            </aside>
          </section>
        </section>

        <!-- Discussion - All -->
        <section>
          <h3>Discussion</h3>
          <ul>
            <li>Questions?</li>
            <li>Other import scenarios</li>
            <li>Feedback</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h2>Any Feedback?</h2>
          <ul>
            <li>We welcome questions and comments on FS.</li>
            <li>What further work on FS would be most useful?</li>
            <!-- <li>Plenty more of this import workshop still to come.</li> -->
            <li>For more detail of FS see last year's workshop.</li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: 'sky', // Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
